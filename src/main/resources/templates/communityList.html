<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì‹œíŒ í¼ ì˜ˆì œ</title>
	<link rel='stylesheet' href='../css/communityList.css' type='text/css'/>
    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© CSS ë§í¬ -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- Select2 CSS ë§í¬ -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Select2 JS ë§í¬ -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© JS ë§í¬ -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <!-- Select2 ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="text/javascript">
    $(document).ready(function(){
       
        $('.postListdiv').on('click', '.postTitle', function() {
            var postId = $(this).data('postid');
            window.location.href = '/communityCard?postId=' + postId;
        });
		
        //ì¢‹ì•„ìš”, ìµœì‹ ìˆœ
        $('#filterOption').change(function() {
            var filterOption = $(this).val();
            
            var districtId= $('#districtSelect').val();
            console.log(districtId);

            $.ajax({
                url: '/filterOption', 
                type: 'GET', 
                data: { filterOption: filterOption,
                     	districtId:districtId}, 
                success: function(response) {
                	updatePostList(response);                	
                },
                error: function(jqXHR, textStatus, errorThrown) {
                   
                    console.error('AJAX Error: ' + textStatus, errorThrown);
                }
            });
  			
        });
        
        // // ìì¹˜êµ¬ í•„í„°ë§    
        $('#districtSelect').change(function() {
            var districtId = $(this).val();

            $.ajax({
                url: '/loadPostsByDistrict', 
                type: 'GET', 
                data: { districtId: districtId }, 
                success: function(response) {
                    updatePostList(response); 
                },
                error: function(jqXHR, textStatus, errorThrown) {
                   
                    console.error('AJAX Error: ' + textStatus, errorThrown);
                }
            });
        });
    });

        $('.postTitle').click(function() {
            var postId = $(this).data('postid');
            window.location.href = '/communityCard?postId=' + postId;
        });
        function updatePostList(posts) {
            // ê²Œì‹œë¬¼ì„ í‘œì‹œí•  DOM ìš”ì†Œ ì„ íƒ
            var postContainer = $('.postListdiv'); 

            // ê¸°ì¡´ ê²Œì‹œë¬¼ ëª©ë¡ì„ ë¹„ìš°ê³  ìƒˆë¡œìš´ ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸
            postContainer.empty();
            
            console.log("postContainer ì‹¤í–‰");
            
            if(posts.length === 0) {
                postContainer.append('<div class="no-posts"><img class="emptyPostimg" src="../assets/images/gps.gif"/><p class="emptyPosttxt">í˜„ì¬ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ê¸€ì„ ì‘ì„±í•´ ì†Œí†µí•´ë³´ì„¸ìš”!</p></div>');
            }  else {
                posts.forEach(function(post) {
                    
                    var postHTML = '<div class="card">';
                    postHTML += '<div class="card-body">';
                    postHTML += '<div class="card-header">';
                    postHTML += '<span>' + post.nickname + '</span>';
                    postHTML += '<div class="location">ì„œìš¸íŠ¹ë³„ì‹œ Â· <span class="postcon" data-postid="' + post.postId + '">' + post.districtName + '</span></div>';
                    postHTML += '</div>';
                    postHTML += '<div class="card-title"><span class="postTitle" data-postid="' + post.postId + '">' + post.title + '</span></div>';
                    postHTML += '<div class="card-text"><span>' + post.content + '</span></div>';
                    postHTML += '<div class="card-footer">';
                    postHTML += '<div class="interaction">';
                    postHTML += '<button class="comment">ğŸ’¬ ' + post.comments + '</button>';
                    postHTML += '<span class="view">ğŸ‘ï¸ ' + post.postView + '</span>';
                    postHTML += '<span class="uploadData">' + post.dateOnly + '</span>';
                    postHTML += '</div></div></div></div>';

                   
                    postContainer.append(postHTML);
                });
            }
        }

    </script>
</head>
<body>
    <div class="container">
        <div class="menu">
            <div class="commutop">
                <div class="commutext"><h3>ì»¤ë®¤ë‹ˆí‹°</h3></div>
                <div class="search">
                    <img src='../assets/images/search.png' />
                    <input class="searchBox" type='text' placeholder='ê²€ìƒ‰ì–´ ì…ë ¥' />
                </div>
            </div>
            <hr>
            <div class="select-row">
                <select class="form-control pt-1 mt-4 selectbox">
                    <option selected>ì„œìš¸íŠ¹ë³„ì‹œ</option>
                </select>
                <select class="form-control pt-1 mt-4 selectbox" id="districtSelect">
					<option  th:value=0  th:text="ìì¹˜êµ¬"></option>
				    <!-- Thymeleaf ë°˜ë³µë¬¸ ì‚¬ìš©í•˜ì—¬ ì˜µì…˜ ìƒì„± -->
				    <option th:each="district : ${districts}" th:value="${district.districtId}" th:text="${district.districtName}"></option>
                </select>
                <select class="form-control pt-1 mt-4 selectbox" id="filterOption">
                    <option selected value="ìµœì‹ ìˆœ">ìµœì‹ ìˆœ</option>
				<option value="ì¡°íšŒìˆœ"> ì¡°íšŒìˆœ </option>
                </select>
            </div>
            <hr>
			<div class="postListdiv">   
			    <th:block th:if="${#lists.isEmpty(postList)}">
			        <div class="no-posts">
			            <img class="emptyPostimg" src='../assets/images/gps.gif'/>
			            <p class="emptyPosttxt">í˜„ì¬ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ê¸€ì„ ì‘ì„±í•´ ì†Œí†µí•´ë³´ì„¸ìš”!</p>
			        </div>
			    </th:block>
			    <div th:each="post : ${postList}">
			        <div class="card">
			            <div class="card-body">
			                <div class="card-header">
			                    <span th:text="${post.nickname}"></span>
			                    <div class="location">ì„œìš¸íŠ¹ë³„ì‹œ Â· <span class="postcon" th:data-postid="${post.postId}" th:text="${post.districtName}"></span></div>
			                </div>
			                <div class="card-title"><span class="postTitle" th:data-postid="${post.postId}" th:text="${post.title}"></span></div>
			                <div class="card-text"><span th:text="${post.content}"></span></div>
			                <div class="card-footer">
			                    <div class="interaction">
			                        <button class="comment">ğŸ’¬ *</button>
			                        <span class="view">ğŸ‘ï¸ <span th:text="${post.postView}"></span></span>
			                        <span class="uploadData"><span th:text="${post.dateOnly}"></span>
			                    </div>
			                </div>
			            </div>
			        </div>
			    </div>
			</div>
        </div>
    </div>
</body>
</html>