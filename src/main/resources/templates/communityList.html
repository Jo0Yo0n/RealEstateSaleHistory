<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>κ²μ‹ν νΌ μμ </title>
    <title>κ²μ‹ν νΌ μμ </title>
	<link rel='stylesheet' href='../css/communityList.css' type='text/css'/>
    <!-- λ¶€νΈμ¤νΈλ© CSS λ§ν¬ -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- Select2 CSS λ§ν¬ -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Select2 JS λ§ν¬ -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <!-- λ¶€νΈμ¤νΈλ© JS λ§ν¬ -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <!-- Select2 μ΄κΈ°ν™” μ¤ν¬λ¦½νΈ -->
    <script type="text/javascript">
        $(document).ready(function(){
            $('#districtSelect').change(function() {
                var districtId = $(this).val();

                // AJAX μ”μ²­ μ„¤μ •
                $.ajax({
                    url: '/loadPostsByDistrict', // λ°μ΄ν„°λ¥Ό κ°€μ Έμ¬ μ—”λ“ν¬μΈνΈ URL
                    type: 'GET', // GET λλ” POST λ°©μ‹ μ„ νƒ
                    data: { districtId: districtId }, // μ”μ²­μ— ν¬ν•¨ν•  λ°μ΄ν„°
                    success: function(response) {
                        // μ„±κ³µμ μΌλ΅ λ°μ΄ν„°λ¥Ό λ°›μ•μ„ λ• μ‹¤ν–‰ν•  μ½”λ“
                        // μ: λ°›μ€ λ°μ΄ν„°λ΅ κ²μ‹λ¬Ό λ©λ΅μ„ μ—…λ°μ΄νΈ
                        updatePostList(response); 
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        // μ¤λ¥ μ²λ¦¬ μ½”λ“
                        console.error('AJAX Error: ' + textStatus, errorThrown);
                    }
                });
            });

            // λ°›μ€ λ°μ΄ν„°λ΅ κ²μ‹λ¬Ό λ©λ΅μ„ μ—…λ°μ΄νΈν•λ” ν•¨μ
            function updatePostList(posts) {
                // κ²μ‹λ¬Όμ„ ν‘μ‹ν•  DOM μ”μ† μ„ νƒ
                var postContainer = $('.card-body'); // μ‹¤μ λ΅λ” λ°μ΄ν„°λ¥Ό ν‘μ‹ν•  μ μ ν• DOM μ”μ† μ„ νƒ

                // κΈ°μ΅΄ κ²μ‹λ¬Ό λ©λ΅μ„ λΉ„μ°κ³  μƒλ΅μ΄ λ°μ΄ν„°λ΅ μ—…λ°μ΄νΈ
                postContainer.empty();
                posts.forEach(function(post) {
                    // κ²μ‹λ¬Όμ„ ν‘μ‹ν•λ” HTML μ½”λ“λ¥Ό μƒμ„±ν•μ—¬ μ¶”κ°€
                    var postHTML = '<div class="card">';
                    postHTML += '<div class="card-body">';
                    postHTML += '<div class="card-header">' + post.nickname + '</div>';
                    postHTML += '<div class="card-title">' + post.title + '</div>';
                    postHTML += '<div class="card-text">' + post.content + '</div>';
                    postHTML += '<div class="card-footer">';
                    postHTML += '<div class="interaction">';
                    postHTML += '<button class="comment">π’¬ ' + post.comments + '</button>';
                    postHTML += '<span class="view">π‘οΈ ' + post.views + '</span>';
                    postHTML += '</div></div></div></div>';

                    // μƒμ„±ν• HTMLμ„ postContainerμ— μ¶”κ°€
                    postContainer.append(postHTML);
                });
            }
           
            $('.postcon').click(function() {
                var postId = $(this).data('postid');
                window.location.href = '/communityCard?postId=' + postId;
            });
        });

    </script>
</head>
<body>
    <div class="container">
        <div class="menu">
            <div class="commutop">
                <div class="commutext"><h3>μ»¤λ®¤λ‹ν‹°</h3></div>
                <div class="search">
                    <img src='../assets/images/search.png' />
                    <input class="searchBox" type='text' placeholder='κ²€μƒ‰μ–΄ μ…λ ¥' />
                </div>
            </div>
            <hr>
            <div class="select-row">
                <select class="form-control pt-1 mt-4 selectbox">
                    <option selected>μ„μΈνΉλ³„μ‹</option>
                </select>
                <select class="form-control pt-1 mt-4 selectbox" id="districtSelect">
					<option value="" disabled selected>μμΉκµ¬</option>
				    <!-- Thymeleaf λ°λ³µλ¬Έ μ‚¬μ©ν•μ—¬ μµμ… μƒμ„± -->
				    <option th:each="district : ${districts}" th:value="${district.districtId}" th:text="${district.districtName}"></option>
                </select>
                <select class="form-control pt-1 mt-4 selectbox">
                    <option selected>μµμ‹ μ</option>
				<option value="" disabled selected>μΆ‹μ•„μ”μ </option>
                </select>
            </div>
            <hr>            
         <th:block th:each="post : ${postList}">
            <div class="card">
                <div class="card-body">
                    <div class="card-header">
                          <span th:text="${post.nickname}"></span>
                        <div class="location">μ„μΈνΉλ³„μ‹ Β· <span class="postcon" th:data-postid="${post.postId}" th:text="${post.districtName}"></span></div>
                    </div>
                    <div class="card-title"><span  class="postcon" th:data-postid="${post.postId}"  th:text="${post.title}"></span></div>
                    <div class="card-text"><span th:text="${post.content}"></span></div>
                    <div class="card-footer">
                        <div class="interaction">
<!--                             <button class="like">π‘ 1</button> -->
                            <button class="comment">π’¬ 1</button>
                            <span class="view">π‘οΈ 1</span>
                        </div>
                    </div>
                </div>
            </div>
          </th:block>
        </div>
    </div>
</body>
</html>