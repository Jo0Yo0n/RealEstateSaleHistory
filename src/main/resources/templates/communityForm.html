<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>File Upload</title>
<script src="https://code.jquery.com/jquery-latest.min.js"></script>
<script>

	// 허용할 파일 확장자 리스트(화이트리스트)
	var allowedExtensions = ['jpg', 'jpeg', 'png', 'gif'];
	var maxSize = 5242880; // 5MB
	
	function checkExtension(fileName, fileSize) {
		var fileExtension = fileName.split('.').pop().toLowerCase(); //.을 기준으로 나눠 마지막 값(확장자)를 소문자로 변환함
		
		if (fileSize >= maxSize) {
			alert("파일 사이즈가 초과되었습니다.");
			return false;
		}
		
		if (allowedExtensions.indexOf(fileExtension) === -1) {
			alert("해당 파일은 허용된 확장자가 아닙니다.");
			return false;
		}
		return true;
	}

	// 파일 업로드 (Ajax로 구현)
	$(document).ready(function(){
	    $("#uploadBtn").on("click", function(e){
	        e.preventDefault(); // 폼의 기본 제출을 막음
	
	        var formData = new FormData();
	        var inputFile = $("input[name='uploadFile']");
	        var files = inputFile[0].files;
	
	        for (var i = 0; i < files.length; i++) {
	        	if (!checkExtension(files[i].name, files[i].size)) {
	        		return false;
	        	}
	            formData.append("uploadFile", files[i]);
	        }
	
	        $.ajax({
	            url: '/fileUpload',
	            type: 'POST',
	            data: formData,
	            processData: false,
	            contentType: false,
	            success: function(result){
	                alert("Uploaded");
	            },
	            error: function(jqXHR, textStatus, errorThrown) {
	                alert("Upload failed: " + textStatus + " - " + errorThrown);
	            }
	        });
	    });
    });
</script>
</head>
<body>
<div class="uploadDiv">
    <input type="file" name="uploadFile" multiple>
</div>
<button id="uploadBtn">전송</button>
</body>
</html>
